<?xml version="1.0" encoding="UTF-8"?>

<?include Version.wxi ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
 xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Fragment>
    <ComponentGroup Id="CompGroup_NemerleBinaries">

      <!-- Nemerle compiler (GAC folder) -->
      <ComponentRef Id="Comp_NemerleCompilerGAC" />
      <ComponentRef Id="Comp_NemerleMacrosGAC" />
      <!-- Nemerle evaluation (GAC folder) -->
      <ComponentRef Id="Comp_NemereEvaluationGAC" />

      <!-- Nemerle compiler (bin folder) -->
      <ComponentRef Id="Comp_NemerleCompiler" />
      <ComponentRef Id="Comp_NemerleCompilerFrontEnd" />
      <ComponentRef Id="Comp_NemerleMacros" />

      <!-- MSBuild task (bin folder) -->
      <ComponentRef Id="Comp_MSBuild" />

      <!-- NAnt task (bin folder) -->
      <ComponentRef Id="Comp_NAnt" />
    </ComponentGroup>

    <!--<DirectoryRef Id="BINDIR">-->
    <DirectoryRef Id="APPLICATIONFOLDER">

      <Component Id="Comp_NemerleCompiler" DiskId="1" Guid="d790d5a5-73c8-46fd-abd3-e628eadecb1f">
        <File Id="File_Nemerle.Compiler.dll" Name="Nemerle.Compiler.dll"  Source="dist\net-4.0\bin\">
           <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.Compiler.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <File Id="File_Nemerle.Compiler.xml" Name="Nemerle.Compiler.xml"  Source="dist\net-4.0\bin\"/>
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.Compiler.pdb" Name="Nemerle.Compiler.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
      </Component>      
      <Component Id="Comp_NemerleMacros" DiskId="1" Guid="adcac690-a2ba-4165-864b-2342e5d96bee">
        <File Id="File_Nemerle.Macros.dll"   Name="Nemerle.Macros.dll"    Source="dist\net-4.0\bin\">
           <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.Macros.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <File Id="File_Nemerle.Macros.xml" Name="Nemerle.Macros.xml"  Source="dist\net-4.0\bin\"/>
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.Macros.pdb" Name="Nemerle.Macros.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
      </Component>      

      <Component Id="Comp_NemerleCompilerFrontEnd" DiskId="1" Guid="df936f75-4632-4319-a958-93de25252778">
        <File Id="File_ncc.exe" Name="ncc.exe" Source="dist\net-4.0\bin\" >
           <netfx:NativeImage Priority="1" Platform="all" Id="Image_ncc.exe" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_ncc.pdb" Name="ncc.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
        <!--
        <Environment Id="Env_Nemerle" Action="set" System="yes" Name="Nemerle" Value="[APPLICATIONFOLDER]" />
        <Environment Id="Env_Path" Action="set" Part="last" System="yes" Name="Path" Value="[APPLICATIONFOLDER]" />
        <RegistryValue Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\ncc.exe"
         Value="[#File_ncc.exe]" Type="string"/>
        -->
      </Component>

      <Component Id="Comp_MSBuild" DiskId="1" Guid="586d3bf5-9fa2-40d5-b232-238fbaeccc70">
        <File Id="File_Nemerle.MSBuild.Tasks.dll" Name="Nemerle.MSBuild.Tasks.dll" Source="dist\net-4.0\bin\" >
           <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.MSBuild.Tasks.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <!-- <File Id="File_Nemerle.MSBuild.Tasks.xml" Name="Nemerle.MSBuild.Tasks.xml" Source="dist\net-4.0\bin\" /> -->
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.MSBuild.Tasks.pdb" Name="Nemerle.MSBuild.Tasks.pdb" Source="dist\net-4.0\bin\"/>
        <?endif ?>
        <File Id="File_Nemerle.MSBuild.targets" Name="Nemerle.MSBuild.targets" Source="dist\net-4.0\bin\" />
        <RegistryKey Root="HKLM" Key="Software\Microsoft\VisualStudio\10.0\MSBuild\SafeImports">
          <RegistryValue Name="Nemerle" Value="[#File_Nemerle.MSBuild.targets]" Type="string" />
        </RegistryKey>
        <RegistryKey Root="HKLM" Key="Software\$(var.ProductName)\net-4.0\InstallDir">
          <RegistryValue Value="[APPLICATIONFOLDER]" Type="string" KeyPath="yes" />
        </RegistryKey> 
      </Component>

      <Component Id="Comp_NAnt" DiskId="1" Guid="8cf53a75-ee8e-479a-9196-0f1f43328bec">
        <File Id="File_Nemerle.NAnt.Tasks.dll" Name="Nemerle.NAnt.Tasks.dll"       Source="dist\net-4.0\bin\" >
           <!--
            Nemerle.NAnt.Tasks.dll does not have a strong name and
            therefore can not be compiled to a native executable.
           -->
           <!-- <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.NAnt.Tasks.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" /> -->
        </File>
        <!--<File Id="File_Nemerle.NAnt.Tasks.xml" Name="Nemerle.NAnt.Tasks.xml"       Source="dist\net-4.0\bin\" />-->
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.NAnt.Tasks.pdb" Name="Nemerle.NAnt.Tasks.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
      </Component>

    </DirectoryRef>

    <DirectoryRef Id="APPLICATIONFOLDER">
      <Directory Id = "CompilerGAC" Name="CompilerGAC">

      <Component Id="Comp_NemerleCompilerGAC" DiskId="1" Guid="b8a9a537-bb79-44c0-b447-67d5fb036f0e">
        <File Id="Gac_Nemerle.Compiler.dll" Name="Nemerle.Compiler.dll" Source="dist\net-4.0\bin\" Assembly=".net" KeyPath="yes" />
      </Component>      
      <Component Id="Comp_NemerleMacrosGAC" DiskId="1" Guid="cd739374-356a-4fb2-9041-37b769b55047">
        <File Id="Gac_Nemerle.Macros.dll"   Name="Nemerle.Macros.dll" Source="dist\net-4.0\bin\" Assembly=".net" KeyPath="yes" />
      </Component>      
      <Component Id="Comp_NemereEvaluationGAC" DiskId="1" Guid="ce75d335-171e-4b33-9dad-c9b64c5007c1">
        <File Id="Gac_Nemerle.Evaluation.dll" Name="Nemerle.Evaluation.dll" Source="dist\net-4.0\bin\" Assembly=".net" KeyPath="yes" />
      </Component>
      </Directory>
    </DirectoryRef>

  </Fragment>
</Wix>