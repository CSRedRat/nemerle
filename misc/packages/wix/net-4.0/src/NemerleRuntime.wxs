<?xml version="1.0" encoding="UTF-8"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
 xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Fragment>
    <ComponentGroup Id="CompGroup_NemerleRuntime">

      <ComponentRef Id="Comp_Nemerle" />

      <!-- Nemerle core runtime components (GAC folder). -->
      <ComponentRef Id="Comp_NemerleGAC" />
      <ComponentRef Id="Comp_NemerleLinqGAC" />

    </ComponentGroup>

    <DirectoryRef Id="APPLICATIONFOLDER">
    <!--<DirectoryRef Id="BINDIR">-->
      <Component Id="Comp_Nemerle" DiskId="1" Guid="4bb6ba5f-60aa-4eae-97ee-c4d262bb6ae6">
        <!-- Nemerle core runtime components (bin folder). -->
        <File Id="File_Nemerle.dll" Name="Nemerle.dll" Source="dist\net-4.0\bin\">
          <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.pdb" Name="Nemerle.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
        <File Id="File_Nemerle.xml" Name="Nemerle.xml" Source="dist\net-4.0\bin\" />

        <!-- Nemerle Linq components (bin folder). -->
        <File Id="File_Nemerle.Linq.dll" Name="Nemerle.Linq.dll" Source="dist\net-4.0\bin\">
          <netfx:NativeImage Priority="1" Platform="all" Id="Image_Nemerle.Linq.dll" Dependencies="no" AppBaseDirectory="APPLICATIONFOLDER" />
        </File>
        <?if $(var.IncludePdb) != false ?>
          <File Id="File_Nemerle.Linq.pdb" Name="Nemerle.Linq.pdb"  Source="dist\net-4.0\bin\"/>
        <?endif ?>
        <!--File Id="File_Nemerle.Linq.xml" Name="Nemerle.Linq.xml" Source="dist\net-4.0\bin\" /-->

        <File Id="File_Junction" Name="SetJunction.exe" Source="dist\net-4.0\bin\" />

        <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\.NETFramework\v4.0.30319\AssemblyFoldersEx\Nemerle">
          <RegistryValue Value="[APPLICATIONFOLDER]" Type="string" />
          <RegistryValue Id="AppFolder" Value="[APPLICATIONFOLDER]" Type="string" />
        </RegistryKey>

      </Component>
    </DirectoryRef>

    <DirectoryRef Id="APPLICATIONFOLDER">
      <Directory Id = "RuntimeGAC" Name="RuntimeGAC">
      <Component Id="Comp_NemerleGAC" DiskId="1" Guid="fc82174a-e032-4bf8-a0df-7964930b554f">
        <File Id="Gac_Nemerle.dll" Name="Nemerle.dll" Source="dist\net-4.0\bin\" Assembly=".net" KeyPath="yes" />
      </Component>
      <Component Id="Comp_NemerleLinqGAC" DiskId="1" Guid="4bffa10e-3bd2-438b-9da7-5b05c08e93ec">
        <File Id="Gac_Nemerle.Linq.dll" Name="Nemerle.Linq.dll" Source="dist\net-4.0\bin\" Assembly=".net" KeyPath="yes" />
      </Component>
    </Directory>
    </DirectoryRef>

  </Fragment>
</Wix>