// REFERENCE: Nemerle.Compiler
using System.Console;
using Nemerle;
using Nemerle.Compiler;

namespace MacroLibrary1
{
  public class Test2
  {
  }
  
  [MacroUsage(MacroPhase.BeforeInheritance, MacroTargets.Class)]
  macro DefaultParmsQuasi(tb : TypeBuilder) 
  {
    DefineDefaultParmsQuasiImpl.DoTransform(tb)
  }

  [MacroUsage(MacroPhase.BeforeTypedMembers, MacroTargets.Class)]
  macro DefaultParmsQuasi(tb : TypeBuilder) 
  {
    DefineDefaultParmsQuasiImpl.DoTransform2(tb)
  }

  [MacroUsage(MacroPhase.WithTypedMembers, MacroTargets.Class)]
  macro DefaultParmsQuasi(tb : TypeBuilder) 
  {
    DefineDefaultParmsQuasiImpl.DoTransform3(tb)
  }
  
  module DefineDefaultParmsQuasiImpl
  {
    public DoTransform(tb : TypeBuilder) : void
    {
      def param = <[ parameter: a : Test2 = null ]> :: [];
      _ = tb.Define(<[decl: public PTest(..$param) : void { _ = a; WriteLine("Test parameter null") } ]>);
    }

    public DoTransform2(tb : TypeBuilder) : void
    {
      _ = tb.Define(<[decl: public PTest3(a : int = 0) : void { _ = a; WriteLine("Test parameter int") } ]>);
    }

    public DoTransform3(tb : TypeBuilder) : void
    {
      _ = tb.Define(<[decl: public PTest4[T](_ : T, _ : T = default(_)) : void { WriteLine("Test parameter default2") } ]>);
      _ = tb.Define(<[decl: public PTest2[T](_ : T, _ : T = default(T)) : void { WriteLine("Test parameter default") } ]>);
    }
    
  }
}
